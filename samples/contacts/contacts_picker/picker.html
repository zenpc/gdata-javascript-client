<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>JavaScript Picker Sample For The Google Contacts Data API</title>
<link rel='stylesheet' type='text/css' href='http://code.google.com/css/dev_docs.css'>
<style type='text/css'>
  table {
    margin-left: auto;
    margin-right: auto;
  }
  table td, table tr {
    border-style: none;
  }
</style>
<script type='text/javascript' src='http://www.google.com/jsapi'></script>
<script type='text/javascript' src='picker.js'></script>
<script type='text/javascript'>
<!--
/* Copyright (c) 2008 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/* Loads the Google Data JavaScript client library */
google.load('gdata', '1.x');

/* Code to make the form on this sample work with the contact picker */
var emailRecipients = [];

/**
 * Clear out the list of recipients. This is called on startup to make sure 
 * that any auto-filling done by browsers does not courrupt our internal
 * state.
 */ 
function clearRecipients() {
  var formRecipients = document.getElementById('recipients');
  formRecipients.value = '';
}

/**
 * Re-generate the contents of the recipient list in the form from 
 * the list of selected contacts.
 */ 
function updateForm() {
  // Create a concatenated version of the emailRecipients array, suitable
  // for use as an email header.
  var emailRecipientsString = '';
  for (var i = 0; i < emailRecipients.length; i++) {
    var recipient = emailRecipients[i];
    emailRecipientsString += recipient + ', ';
  };
  emailRecipientsString = emailRecipientsString.substring(0, emailRecipientsString.length - 2);
  
  // Update the recipient display on the form
  var formRecipients = document.getElementById('recipients');
  formRecipients.value = emailRecipientsString;
}

/**
 * Read the contents of the form into a mailto: URI and ask the browser to
 * go there, sending the mail message.
 */ 
function sendMessage() {
  // Get form data
  var formRecipients = document.getElementById('recipients').value;
  var formSubject = document.getElementById('subject').value;
  var formMessage = document.getElementById('message').value;
  window.location = 'mailto:' + formRecipients + '?subject=' + formSubject + '&body=' + formMessage;
}

/**
 * Callback method to let the contact picker inform us of user selections.
 */ 
var addContact = function(contactEntry) {
  // Extract email addresses from the contact entry.
  var emailAddresses = contactEntry.getEmailAddresses();
  
  // Add the new address to our list of recipients and update the form. If
  // the user has more than one address, we'll just use the first one 
  // listed.
  if (emailAddresses) {
    emailRecipients.push(emailAddresses[0].getAddress());
  }
  updateForm();
}

/**
 * Callback method to let the contact picker inform us of user de-selections.
 */ 
var removeContact = function(contactEntry) {
  // Extract email addresses from the contact entry.
  var emailAddresses = contactEntry.getEmailAddresses();
  
  // Remove the new address from our list of recipients and update the 
  // form. Ifthe user has more than one address, we'll just use the first 
  // one listed.
  if (emailAddresses) {
    var addressToRemove = emailAddresses[0].getAddress();
    
    // Locate the index of the address
    var result = -1;
    for (var i = 0; i < emailRecipients.length && result == -1; i++) {
      if (emailRecipients[i] == addressToRemove)
        result = i;
    }
    
    // Remove the address from the array
    if (result != -1) {
      emailRecipients.splice(result, 1);
    }
  }
  updateForm();
}

/**
 * Callback method to use prepare the system after the Google JavaScript
 * client library has loaded.
 */ 
function init() {
    /* Configure options for this sample */
    Picker.setServiceName('Google-PickerSample-1-0');
    Picker.setUserAddCallback(addContact);
    Picker.setUserRemoveCallback(removeContact);
    clearRecipients();
    Picker.render('picker_container');
}

google.setOnLoadCallback(init);
-->
</script>
</head>
<body>
  <h1 id='javascript_picker_sample_for_the_google_contacts_data_api'>JavaScript Picker Sample For The Google Contacts Data API</h1>

  <p>This sample demonstrates displaying a list of contacts received from a user&#8217;s GMail contact list using the <a href='http://code.google.com/apis/contacts/developers_guide_js.html'>Google Data JavaScript client library</a> in conjunction with the <a href='http://code.google.com/apis/contacts/'>Google Contacts Data API</a>.</p>

  <p>After logging in to your Google account below, the JavaScript client library retrieves a Google Data feed describing the contact groups that are associated with an account. At a minimum, all users have an &#8220;All Contacts&#8221; group. Other groups will not exist unless they have been explicitly created by the user.</p>

  <p>Once a group has been selected, the list of contacts who exist within that group will be downloaded by requesting a different Google Data feed. Clicking on a contact&#8217;s name will download and display relevant information about that contact.</p>

  <p>By clicking the checkboxes next to each contact, you will be selecting those contacts for some future action. The action performed is determined by a callback function, specified by the application developer during initialization of the script. Contacts may be selected as desired from any mix of groups, the sample maintains internal state so that a contact's selection history is preserved during the course of individual sessions.</p>

  <p>For the purposes of this sample, the contacts selected will be used to populate the To: header in email message. Since this sample does not have any supporting server-side logic, this message will be opened for sending using your local mail client, if any.</p>

  <p>As this sample uses a JavaScript client library, JavaScript support must be enabled in your web browser. If this may be a concern in your application, you may wish to consider one of the <a href='http://code.google.com/apis/gdata/clientlibs.html'>other Google Data client libraries</a>.</p>

  <h2 id='login_and_select_contacts'><img src='../../common/images/steps/1b.gif' alt='1' style='vertical-align:middle; margin: 0;'>Login and select contacts</h2>

  <div id='picker_container' style='width: 90%; margin: auto'></div>

  <h2 id='compose_and_send_message'><img src='../../common/images/steps/2b.gif' alt='2' style='vertical-align:middle; margin: 0;'>Compose &amp; Send Message</h2>

  <form accept-charset='utf-8'>
    <table>
      <tr>
        <td valign='top'>To:</td>
        <td>
          <textarea id='recipients' name='recipients' rows='3' cols='55' disabled='true'></textarea>
          <p style='font-size: 70%;'><em><strong>Reminder:</strong> This field is automatically populated based on selections in the previous step.</em></p>
        </td>
      </tr>
      <tr>
        <td valign='top'>Subject:</td>
        <td>
          <input type='text' id='subject' name='subject' value='Your Subject Here' size='64'/>
        </td>
      </tr>
      <tr>
        <td valign='top'>Message:</td>
        <td>
          <textarea id='message' name='message' rows='12' cols='62'></textarea>
        </td>
      </tr>
      <tr>
        <td>
        </td>
        <td align='right'>
          <input type='button' value='Compose Message &rarr;' onclick='sendMessage()'>
          <p style='font-size: 70%;'><em><strong>Note:</strong> This message will be opened (unsent) in your primary mail client.</em></p>
        </td>
      </tr>
    </table>
  </form>

  <h2 id='download_and_customize'><img src='../../common/images/steps/3b.gif' alt='3' style='vertical-align:middle; margin: 0;'>Download And Customize</h2>

  <p>Now that you&#8217;ve gotten a taste for how the contact picker sample works, play around with it, take it apart, and adapt it to your own needs. Start by obtaining a copy of the contact picker source: <a href='picker.js'>picker.js</a>.</p>

  <p>Once you&#8217;ve downloaded this file, embed it in your HTML document along with the Google JavaScript API loader:</p>

  <pre><code>&lt;script type="text/javascript"
  src="http://www.google.com/jsapi"&gt;
&lt;/script&gt;
&lt;script type="text/javascript"
  src="picker.js"&gt;
&lt;/script&gt;</code></pre>

  <p>The next step is to load the Google Data client library. Since the JavaScript API loader is now embedded in your document, you can just call the <code>gdata.load()</code> function from within a <code>&lt;script&gt;</code> tag in the <code>&lt;head&gt;</code> of your HTML document:</p>

  <pre><code>google.load("gdata", "1.x");</code></pre>

  <p>Provide the contact picker with a unique name to identify your application when communicating with Google&#8217;s servers:</p>

  <pre><code>Picker.setServiceName('Google-PickerSample-1-0');</code></pre>

  <p>The contact picker will need to know about callback functions to be invoked when contacts are added or removed. These functions must accept one parameter, namely a reference to the <code>ContactEntry</code> that is being added or removed:
    </p>

  <pre><code>var userAdded = function(contactEntry) {
  // Do something
}

var userRemoved = function(contactEntry) {
  // Do something else
}

Picker.setUserAddCallback(addContact);
Picker.setUserRemoveCallback(removeContact);</code></pre>

  <p>Detailed information about the <code>ContactEntry</code> class is available in the <a href='http://code.google.com/apis/gdata/jsdoc/1.3/index.html'>JavaScript client library reference guide</a>.</p>

  <p>Finally, create a <code>&lt;div&gt;</code> to hold the contact picker user interface, and add  <code>Picker.render()</code> to your document&#8217;s <code>onload</code> event handler. <code>Picker.render()</code> takes as an argument the ID of the <code>&lt;div&gt;</code> that will be holding the contact picker.</p>

  <p>Your finished HTML document should look like this:</p>

  <pre><code>&lt;html&gt;
&lt;head&gt;
...
&lt;script type="text/javascript"
  src="http://www.google.com/jsapi"&gt;
&lt;/script&gt;

&lt;script type="text/javascript"
  src="picker.js"&gt;
&lt;/script&gt;

&lt;script&gt;
  var userAdded = function(contactEntry) {
    // Do something
  }

  var userRemoved = function(contactEntry) {
    // Do something else
  }

  google.load("gdata", "1.x");
  Picker.setServiceName('Google-PickerSample-1-0');
  Picker.setUserAddCallback(addContact);
  Picker.setUserRemoveCallback(removeContact);
&lt;/script&gt;
&lt;/head&gt;
&lt;body onload="Picker.render('picker_container')"&gt;
...
&lt;div id="picker_container"&gt;&lt;/div&gt;</code></pre>

  <p>At this point, you should be ready to begin development. Happy coding!</p>

  <h3 id='resources'>Resources</h3>

  <ul>
  <li><a href='http://code.google.com/apis/contacts/'>Google Contacts Data API</a></li>
  <li><a href='http://code.google.com/apis/contacts/developers_guide_js.html'>Google Contacts Data API Developer&#8217;s Guide for JavaScript</a></li>
  <li><a href='http://code.google.com/apis/gdata/jsdoc/1.3/index.html'>Google Data JavaScript Client Library Reference Guide</a></li>
  <li><a href='http://groups.google.com/group/google-contacts-api'>Google Contacts API Group</a></li>
  </ul>
</body>
</html>
